---
aliases: [正则表达式 ]
author: lgf
created: 45_2022-11-12 19:15:01
modified: 45_2022-11-12 19:56:07
tags: [learn/program/javascript]
title: 正则表达式 
---
# 正则表达式
## 基础知识

> 向军大叔每晚八点在 [抖音 (opens new window)](https://live.douyin.com/houdunren) 和 [bilibli (opens new window)](https://space.bilibili.com/282190994) 直播

正则表达式是用于匹配字符串中字符组合的模式，在 JavaScript 中，正则表达式也是对象。

-   正则表达式是在宿主环境下运行的，如`js/php/node.js` 等
-   本章讲解的知识在其他语言中知识也是可用的，会有些函数使用上的区别

### 对比分析

与普通函数操作字符串来比较，正则表达式可以写出更简洁、功能强大的代码。

下面使用获取字符串中的所有数字来比较函数与正则的差异。

使用正则表达式将简单得多

### 创建正则

JS 提供字面量与对象两种方式创建正则表达式

#### 字面量创建

使用`//`包裹的字面量创建方式是推荐的作法，但它不能在其中使用变量

下面尝试使用 `a` 变量时将不可以查询

虽然可以使用 `eval` 转换为 js 语法来实现将变量解析到正则中，但是比较麻烦，所以有变量时建议使用下面的对象创建方式

#### 对象创建

当正则需要动态创建时使用对象方式

根据用户输入高亮显示内容，支持用户输入正则表达式

通过对象创建正则提取标签

### 选择符

`|` 这个符号带表选择修释符，也就是 `|` 左右两侧有一个匹配到就可以。

检测电话是否是上海或北京的坐机

匹配字符是否包含`houdunren` 或 `hdcms`

### 字符转义

转义用于改变字符的含义，用来对某个字符有多种语义时的处理。

假如有这样的场景，如果我们想通过正则查找`/`符号，但是 `/`在正则中有特殊的意义。如果写成`///`这会造成解析错误，所以要使用转义语法 `/\//`来匹配。

使用 `RegExp` 构建正则时在转义上会有些区别，下面是对象与字面量定义正则时区别

下面是网址检测中转义符使用

### 字符边界

使用字符边界符用于控制匹配内容的开始与结束约定。

| 边界符 | 说明                         |
| ------ | ---------------------------- |
| ^      | 匹配字符串的开始             |
| $      | 匹配字符串的结束，忽略换行符 |

匹配内容必须以`www`开始

匹配内容必须以`.com`结束

检测用户名长度为 3~6 位，且只能为字母。如果不使用 `^与$` 限制将得不到正确结果

## 元子字符

元字符是正则表达式中的最小元素，只代表单一（一个）字符

### 字符列表

| 元字符 | 说明                                                 | 示例                 |
| ------ | ---------------------------------------------------- | -------------------- |
| \\d    | 匹配任意一个数字                                     | \[0-9\]              |
| \\D    | 与除了数字以外的任何一个字符匹配                     | \[^0-9\]             |
| \\w    | 与任意一个英文字母,数字或下划线匹配                  | \[a-zA-Z\_\]         |
| \\W    | 除了字母,数字或下划线外与任何字符匹配                | \[^a-za-z\_\]        |
| \\s    | 任意一个空白字符匹配，如空格，制表符`\t`，换行符`\n` | \[\\n\\f\\r\\t\\v\]  |
| \\S    | 除了空白符外任意一个字符匹配                         | \[^\\n\\f\\r\\t\\v\] |
| .      | 匹配除换行符外的任意字符                             |                      |

### 使用体验

匹配任意数字

匹配所有电话号码

获取所有用户名

匹配任意非数字

匹配字母数字下划线

匹配除了字母,数字或下划线外与任何字符匹配

匹配与任意一个空白字符匹配

匹配除了空白符外任意一个字符匹配

如果要匹配点则需要转义

使用`.`匹配除换行符外任意字符，下面匹配不到`hdcms.com` 因为有换行符

使用`/s`视为单行模式（忽略换行）时，`.` 可以匹配所有

正则中空格会按普通字符对待

### 所有字符

可以使用 `[\s\S]` 或 `[\d\D]` 来匹配所有字符

## 模式修饰

正则表达式在执行时会按他们的默认执行方式进行，但有时候默认的处理方式总不能满足我们的需求，所以可以使用模式修正符更改默认方式。

| 修饰符 | 说明                                         |
| ------ | -------------------------------------------- |
| i      | 不区分大小写字母的匹配                       |
| g      | 全局搜索所有匹配内容                         |
| m      | 视为多行                                     |
| s      | 视为单行忽略换行符，使用`.` 可以匹配所有字符 |
| y      | 从 `regexp.lastIndex` 开始匹配               |
| u      | 正确处理四个字符的 UTF-16 编码               |

### I

将所有`houdunren.com` 统一为小写

### G

使用 `g` 修饰符可以全局操作内容

### M

用于将内容视为多行匹配，主要是对 `^`和 `$` 的修饰

将下面是将以 `#数字`开始的课程解析为对象结构，学习过后面讲到的原子组可以让代码简单些

### U

每个字符都有属性，如`L`属性表示是字母，`P` 表示标点符号，需要结合 `u` 模式才有效。其他属性简写可以访问 [属性的别名 (opens new window)](https://www.unicode.org/Public/UCD/latest/ucd/PropertyValueAliases.txt) 网站查看。

字符也有 unicode 文字系统属性 `Script=文字系统`，下面是使用 `\p{sc=Han}` 获取中文字符 `han`为中文系统，其他语言请查看 [文字语言表 (opens new window)](http://www.unicode.org/standard/supported.html)

使用 `u` 模式可以正确处理四个字符的 UTF-16 字节编码

### lastIndex

RegExp 对象`lastIndex` 属性可以返回或者设置正则表达式开始匹配的位置

-   必须结合 `g` 修饰符使用
-   对 `exec` 方法有效
-   匹配完成时，`lastIndex` 会被重置为 0

### Y

我们来对比使用 `y` 与`g` 模式，使用 `g` 模式会一直匹配字符串

但使用`y` 模式后如果从 `lastIndex` 开始匹配不成功就不继续匹配了

因为使用 `y` 模式可以在匹配不到时停止匹配，在匹配下面字符中的 qq 时可以提高匹配效率

## 原子表

在一组字符中匹配某个元字符，在正则表达式中通过元字符表来完成，就是放到`[]` (方括号)中。

### 使用语法

| 原子表  | 说明                               |
| ------- | ---------------------------------- |
| \[\]    | 只匹配其中的一个原子               |
| \[^\]   | 只匹配"除了"其中字符的任意一个原子 |
| \[0-9\] | 匹配 0-9 任何一个数字              |
| \[a-z\] | 匹配小写 a-z 任何一个字母          |
| \[A-Z\] | 匹配大写 A-Z 任何一个字母          |

### 实例操作

使用`[]`匹配其中任意字符即成功，下例中匹配`ue`任何一个字符，而不会当成一个整体来对待

日期的匹配

获取`0~3`间的任意数字

匹配`a~f`间的任意字符

顺序为升序否则将报错

字母也要升序否则也报错

获取所有用户名

原子表中有些正则字符不需要转义，如果转义也是没问题的，可以理解为在原子表中`.` 就是小数点

可以使用 `[\s\S]` 或 `[\d\D]`匹配到所有字符包括换行符

下面是使用原子表知识删除所有标题

## 原子组

-   如果一次要匹配多个元子，可以通过元子组完成
-   原子组与原子表的差别在于原子组一次匹配多个元子，而原子表则是匹配任意一个字符
-   元字符组用 `()` 包裹

下面使用原子组匹配 `h1` 标签，如果想匹配 `h2` 只需要把前面原子组改为 `h2` 即可。

### 基本使用

没有添加 `g` 模式修正符时只匹配到第一个，匹配到的信息包含以下数据

| 变量    | 说明             |
| ------- | ---------------- |
| 0       | 匹配到的完整内容 |
| 1,2.... | 匹配到的原子组   |
| index   | 原字符串中的位置 |
| input   | 原字符串         |
| groups  | 命名分组         |

在`match`中使用原子组匹配，会将每个组数据返回到结果中

-   0 为匹配到的完成内容
-   1/2 等 为原子级内容
-   index 匹配的开始位置
-   input 原始数据
-   groups 组别名

下面使用原子组匹配标题元素

检测 `0~100` 的数值，使用 `parseInt` 将数值转为 10 进制

### 邮箱匹配

下面使用原子组匹配邮箱

如果邮箱是以下格式 `houdunren@hd.com.cn` 上面规则将无效，需要定义以下方式

### 引用分组

`\n` 在匹配时引用原子组， `$n` 指在替换时使用匹配的组数据。下面将标签替换为`p`标签

如果只希望组参与匹配，便不希望返回到结果中使用 `(?:` 处理。下面是获取所有域名的示例

### 分组别名

如果希望返回的组数据更清晰，可以为原子组编号，结果将保存在返回的 `groups`字段中

组别名使用 `?<>` 形式定义，下面将标签替换为`p`标签

获取链接与网站名称组成数组集合

## 重复匹配

### 基本使用

如果要重复匹配一些内容时我们要使用重复匹配修饰符，包括以下几种。

| 符号  | 说明              |
| ----- | ----------------- |
| \*    | 重复零次或更多次  |
| +     | 重复一次或更多次  |
| ?     | 重复零次或一次    |
| {n}   | 重复 n 次         |
| {n,}  | 重复 n 次或更多次 |
| {n,m} | 重复 n 到 m 次    |

> 因为正则最小单位是元字符，而我们很少只匹配一个元字符如 a、b 所以基本上重复匹配在每条正则语句中都是必用到的内容。

默认情况下重复选项对单个字符进行重复匹配，即不是贪婪匹配

使用原子组后则对整个组重复匹配

下面是验证坐机号的正则

验证用户名只能为 3~8 位的字母或数字，并以字母开始

验证密码必须包含大写字母并在 5~10 位之间

### 禁止贪婪

正则表达式在进行重复匹配时，默认是贪婪匹配模式，也就是说会尽量匹配更多内容，但是有的时候我们并不希望他匹配更多内容，这时可以通过?进行修饰来禁止重复匹配

| 使用   | 说明                              |
| ------ | --------------------------------- |
| \*?    | 重复任意次，但尽可能少重复        |
| +?     | 重复 1 次或更多次，但尽可能少重复 |
| ??     | 重复 0 次或 1 次，但尽可能少重复  |
| {n,m}? | 重复 n 到 m 次，但尽可能少重复    |
| {n,}?  | 重复 n 次以上，但尽可能少重复     |

下面是禁止贪婪的语法例子

将所有 span 更换为`h4` 并描红，并在内容前加上 `后盾人-`

下面是使用禁止贪婪查找页面中的标题元素

## 全局匹配

### 问题分析

下面是使用`match` 全局获取页面中标签内容，但并不会返回匹配细节

### matchAll

在新浏览器中支持使用 `matchAll` 操作，并返回迭代对象

> 需要添加 `g` 修饰符

在原型定义 `matchAll`方法，用于在旧浏览器中工作，不需要添加`g` 模式运行

### Exec

使用 `g` 模式修正符并结合 `exec` 循环操作可以获取结果和匹配细节

使用上面定义的函数来检索字符串中的网址

## 字符方法

下面介绍的方法是 `String` 提供的支持正则表达式的方法

### Search

search() 方法用于检索字符串中指定的子字符串，也可以使用正则表达式搜索，返回值为索引位置

使用正则表达式搜索

### Match

直接使用字符串搜索

使用正则获取内容，下面是简单的搜索字符串

如果使用 `g` 修饰符时，就不会有结果的详细信息了（可以使用 exec），下面是获取所有 h1~6 的标题元素

### matchAll

在新浏览器中支持使用 `matchAll` 操作，并返回迭代对象

### Split

用于使用字符串或正则表达式分隔字符串，下面是使用字符串分隔日期

如果日期的连接符不确定，那就要使用正则操作了

### Replace

`replace` 方法不仅可以执行基本字符替换，也可以进行正则替换，下面替换日期连接符

替换字符串可以插入下面的特殊变量名：

| 变量 | 说明                                                                                                                   |
| ---- | ---------------------------------------------------------------------------------------------------------------------- |
| `$$` | 插入一个 "$"。                                                                                                         |
| `$&` | 插入匹配的子串。                                                                                                       |
| $\`  | 插入当前匹配的子串左边的内容。                                                                                         |
| `$'` | 插入当前匹配的子串右边的内容。                                                                                         |
| `$n` | 假如第一个参数是 `RegExp` 对象，并且 n 是个小于 100 的非负整数，那么插入第 n 个括号匹配的字符串。提示：索引是从 1 开始 |

在后盾人前后添加三个`=`

把电话号用 `-` 连接

把所有`教育`汉字加上链接 `https://www.houdunren.com`

为链接添加上`https` ，并补全 `www.`

将标题标签全部替换为 `p` 标签

删除页面中的 `h1~h6` 标签

**回调函数**

replace 支持回调函数操作，用于处理复杂的替换逻辑

| 变量名            | 代表的值                                                                                                                                                                                               |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `match`           | 匹配的子串。（对应于上述的$&。）                                                                                                                                                                       |
| `p1,p2, ...`      | 假如 replace()方法的第一个参数是一个 `RegExp` 对象，则代表第 n 个括号匹配的字符串。（对应于上述的$1，$2 等。）例如，如果是用 `/(\a+)(\b+)/` 这个来匹配，`p1` 就是匹配的 `\a+`，`p2` 就是匹配的 `\b+`。 |
| `offset`          | 匹配到的子字符串在原字符串中的偏移量。（比如，如果原字符串是 `'abcd'`，匹配到的子字符串是 `'bc'`，那么这个参数将会是 1）                                                                               |
| `string`          | 被匹配的原字符串。                                                                                                                                                                                     |
| NamedCaptureGroup | 命名捕获组匹配的对象                                                                                                                                                                                   |

使用回调函数将 `后盾人` 添加上链接

为所有标题添加上 `hot` 类

## 正则方法

下面是 `RegExp` 正则对象提供的操作方法

### Test

检测输入的邮箱是否合法

### Exec

不使用 `g` 修饰符时与 `match` 方法使用相似，使用 `g` 修饰符后可以循环调用直到全部匹配完。

-   使用 `g` 修饰符多次操作时使用同一个正则，即把正则定义为变量使用
-   使用 `g` 修饰符最后匹配不到时返回 `null`

计算内容中后盾人出现的次数

## 断言匹配

断言虽然写在扩号中但它不是组，所以不会在匹配结果中保存，可以将断言理解为正则中的条件。

### (?=exp)

**零宽先行断言** `?=exp` 匹配后面为 `exp` 的内容

把后面是`教程` 的后盾人汉字加上链接

下面是将价格后面 添加上 `.00`

使用断言验证用户名必须为五位，下面正则体现断言是不是组，并且不在匹配结果中记录

### (?<=exp)

**零宽后行断言** `?<=exp` 匹配前面为 `exp` 的内容

匹配前面是`houdunren` 的数字

匹配前后都是数字的内容

所有超链接替换为`houdunren.com`

下例中将 `后盾人` 后面的视频添加上链接

将电话的后四位模糊处理

获取标题中的内容

### (?!exp)

**零宽负向先行断言** 后面不能出现 `exp` 指定的内容

使用 `(?!exp)`字母后面不能为两位数字

下例为用户名中不能出现`向军`

### (?<!exp)

**零宽负向后行断言** 前面不能出现 exp 指定的内容

获取前面不是数字的字符

把所有不是以 `https://oss.houdunren.com` 开始的静态资源替换为新网址
